<html>
<head>
<title>JUST THE TIP</title>
<link href="css/application.css" rel="stylesheet" type="text/css">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<script src="js/jquery-2.0.3.min.js"></script>
<script src="js/ICanHaz.min.js"></script>
<script src="js/venue.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript" src="js/app.js"></script>

<script id="home" type="text/html">

<div id="splashlogo" class="moveUp"><img src="img/splash-logo.png" /></div>
      <div id="homeStuff" style="display:block;">
        <form id="homeSearch" name="homeSearch" action="" method="post">
          <input class="field" id="search_field" name="search" type="text" placeholder="I'm Looking For...">
                    <div id="search-button" class="field"></div>
                    <a href="#">
                        <div class="connect4sqButton field">
                            <div class="buttonImg"></div>
                        </div>
                    </a>
          <div id="helpText"></div>
        </form>
      </div>
</script>
<script id="venue" type="text/html">

<strong>name:</strong>{{ name }} <br />
<strong>address:</strong>{{ location.address }} <br />
<strong>lat:</strong>{{ location.lat }} <br />
<strong>long:</strong>{{ location.long }} <br />
<strong>distance:</strong>{{ location.distance }} <br />
<strong>postalCode:</strong>{{ location.postalCode }} <br />
<strong>City:</strong>{{ location.city }} <br />
<strong>State:</strong>{{ location.state }} <br />
<strong>Country:</strong>{{ location.country }} <br />
<img src="{{photo_url}}">
</script>

<script id="venue_results" type="text/html">
<div class="header">
        <div class="backarrow"></div>
        <div class="logo"></div>
        <div class="searchBar">
          <input class="textField" id="venue-search-box" name="search" type="text" placeholder="I'm Looking For...">
          <div class="close-search"><img src="img/x-white.png" /></div>
        </div>
        <div class="search"></div>
      </div>
      <div id="searchResultsWrap">
        <div id="searchResults">
          <div id="name">Search Results for "{{ query }}"</div>
          {{#venues}}
          <a class="venue_link" href="venues/{{venue_id}}">
          <div class="result">
            <div class="top">
              <div class="catIcon"><img src="{{category_icon_url}}" /></div>
              <div class="info">
                <div class="name">{{name}}</div>
                <div class="category">{{category_name}}</div>
                <div class="address">{{location.address}} {{location.city}}, {{location.state}} {{location.postalCode}}</div>
              </div>
              <div class="numTips">
                <img src="img/lightbulb.png" /><div class="actual-num">x {{live_tip_count}}</div>
              </div>
            </div>
          </div></a>
          {{/venues}}
        </div>
      </div>
</script>

    <script type="text/javascript">
(function() {
    // There's nothing to do for older browsers ;)
    if (!window.addEventListener)
        return;
    var blockPopstateEvent = true;
    window.addEventListener("load", function() {
        // The timeout ensures that popstate-events will be unblocked right
        // after the load event occured, but not in the same event-loop cycle.
        setTimeout(function(){ blockPopstateEvent = false; }, 0);
    }, false);
    window.addEventListener("popstate", function(evt) {
        if (blockPopstateEvent && document.readyState=="complete") {
            evt.preventDefault();
            evt.stopImmediatePropagation();
        }
    }, false);
})();
// when the dom's ready
    $(document).ready(function () {
      $(document).on("submit","form#homeSearch",function(e){
        e.preventDefault();
        console.log("asdf");
        history.pushState({},"","search?query="+$("#search_field").val());
        if(navigator.geolocation){
          navigator.geolocation.getCurrentPosition(handleGetCurrentPosition, onError);
        }
      });

    $(window).on("popstate", function(e) {
      var after_slash = location.href.replace(/^(?:\/\/|[^\/]+)*\//, "");
      var output_html;
        if(after_slash=="") {
          output_html = ich.home();
        $("#wrap").html(output_html);
        } else {
          var params = getVars(after_slash);
          if (after_slash.slice(0,after_slash.indexOf('?'))=="search")
            { 
              if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(handleGetCurrentPosition, onError);
              }
            }
        }
    });
    });
    </script>

    </head>
    <body>
		<div id="wrap">
			<div id="splashlogo"><img src="img/splash-logo.png" /></div>
			<div id="homeStuff">
				<form id="homeSearch" name="homeSearch" action="" method="post">
					<input class="field" id="search_field" name="search" type="text" placeholder="I'm Looking For...">
                    <div id="search-button" class="field"></div>
                    <a href="#">
                        <div class="connect4sqButton field">
                            <div class="buttonImg"></div>
                        </div>
                    </a>
					<div id="helpText"></div>
				</form>
			</div>
		</div>
    </body>
    </html>
